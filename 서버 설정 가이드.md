## 리눅스 클라우드 서버 설정 가이드 (GitHub 동기화) - v2

이 문서는 GitHub 저장소를 리눅스 클라우드 서버에 동기화하고 자동매매 프로그램을 실행하기 위한 단계별 가이드입니다. 서버에 접속한 후, 다음 명령어를 순서대로 실행하시면 됩니다.

---

### **※ 중요: 실행 환경 권장 사항**

이 가이드의 모든 명령어는 `root` 사용자가 아닌, **별도의 일반 사용자(non-root user, 예: `ubuntu`) 계정에서 실행**하는 것을 강력히 권장합니다.

`root` 계정에서 직접 프로그램을 실행할 경우, 프로그램의 작은 취약점이 서버 전체의 보안 위협으로 이어질 수 있습니다. 일반 사용자의 홈 디렉터리(예: `/home/ubuntu/`)에 프로젝트를 위치시키는 것이 가장 안전하고 표준적인 방법입니다.

---

#### **참고: 새 일반 사용자 추가 방법 (Ubuntu/Debian 기준)**
만약 `root` 계정만 있다면, 아래 명령어로 새 사용자를 만들고 권한을 부여한 뒤 전환하여 진행하세요.

1.  **새 사용자 생성 (`<username>`을 원하는 이름으로 변경)**
    ```bash
    adduser <username>
    ```

2.  **sudo 권한 부여 (관리자 명령어 실행을 위함)**
    ```bash
    usermod -aG sudo <username>
    ```

3.  **새 사용자로 전환**
    ```bash
    su - <username>
    ```
이제 프롬프트가 바뀌며, 이 사용자의 홈 디렉터리에서 다음 단계를 진행할 수 있습니다.

---

### 1단계: 서버에 기본 도구 설치 (Git, Python, pip)

서버에 Git, Python3, pip3가 이미 설치되어 있는지 확인하고, 설치되어 있지 않다면 설치합니다. 아래 스크립트를 복사하여 터미널에 붙여넣고 실행하세요.

```bash
# Git 설치 확인 및 설치
if ! command -v git &> /dev/null; then
    echo "Git이 설치되어 있지 않습니다. Git을 설치합니다."
    sudo apt-get update && sudo apt-get install git -y
else
    echo "Git이 이미 설치되어 있습니다: $(git --version)"
fi

# Python3 설치 확인 및 설치
if ! command -v python3 &> /dev/null; then
    echo "Python3이 설치되어 있지 않습니다. Python3을 설치합니다."
    sudo apt-get update && sudo apt-get install python3 -y
else
    echo "Python3이 이미 설치되어 있습니다: $(python3 --version)"
fi

# pip3 설치 확인 및 설치 (오류 해결 로직 포함)
if ! command -v pip3 &> /dev/null; then
    echo "pip3이 설치되어 있지 않습니다. pip3 설치를 시도합니다."
    # apt-get update를 먼저 실행하여 패키지 목록을 최신화합니다.
    sudo apt-get update
    # software-properties-common 패키지 설치 (add-apt-repository를 위함)
    sudo apt-get install -y software-properties-common
    # universe 저장소 추가 (python3-pip가 포함된 경우가 많음)
    sudo add-apt-repository universe
    # 다시 패키지 목록 최신화
    sudo apt-get update
    # python3-pip 설치
    sudo apt-get install -y python3-pip
    
    # 최종 확인
    if ! command -v pip3 &> /dev/null; then
        echo "pip3 설치에 실패했습니다. 시스템 환경을 확인해주세요."
    else
        echo "pip3 설치가 완료되었습니다."
    fi
else
    echo "pip3가 이미 설치되어 있습니다: $(pip3 --version)"
fi

```
*(위 스크립트는 Ubuntu/Debian 기반 시스템용입니다.)*

---

### 2단계: GitHub에서 프로젝트 클론 (Clone)

프로젝트를 복제합니다. (`--recurse-submodules` 옵션 필수)

1.  **프로젝트 클론:** `git clone --recurse-submodules https://github.com/manin21st/trade_stock.git`
2.  **폴더로 이동:** `cd trade_stock`

---

### 3단계: 파이썬 라이브러리 설치

`open-trading-api` 폴더의 `requirements.txt`를 사용하여 라이브러리를 설치합니다.

```bash
cd open-trading-api && pip3 install -r requirements.txt && cd ..
```

---

### 4단계: 설정 파일(`kis_devlp.yaml`) 생성

리눅스 홈 디렉터리 아래에 설정 파일을 생성합니다.

1.  **디렉터리 생성:** `mkdir -p ~/KIS/config`
2.  **설정 파일 생성 및 편집:** `nano ~/KIS/config/kis_devlp.yaml`
    (로컬 PC의 파일 내용을 복사하여 붙여넣고 저장)

---

### 5단계: 자동매매 엔진 실행

`nohup`을 사용하여 백그라운드에서 자동매매 엔진을 실행합니다.

1.  **실행:** `nohup python3 main_cmd.py &`
2.  **로그 확인:** `tail -f nohup.out` 또는 `tail -f main_cmd.log`
3.  **종료:** `ps -ef | grep main_cmd.py`로 PID를 찾은 후 `kill <PID>`

---

### 6단계: 향후 업데이트 동기화

로컬 PC의 변경 사항을 서버에 반영합니다.

```bash
git pull && git submodule update --init --recursive
```