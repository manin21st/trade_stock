## 리눅스 클라우드 서버 설정 가이드 (GitHub 동기화) - v2

이 문서는 GitHub 저장소를 리눅스 클라우드 서버에 동기화하고 자동매매 프로그램을 실행하기 위한 단계별 가이드입니다. 서버에 접속한 후, 다음 명령어를 순서대로 실행하시면 됩니다.

---

### **※ 중요: 실행 환경 권장 사항**

이 가이드의 모든 명령어는 `root` 사용자가 아닌, **별도의 일반 사용자(non-root user, 예: `ubuntu`) 계정에서 실행**하는 것을 강력히 권장합니다.

`root` 계정에서 직접 프로그램을 실행할 경우, 프로그램의 작은 취약점이 서버 전체의 보안 위협으로 이어질 수 있습니다. 일반 사용자의 홈 디렉터리(예: `/home/ubuntu/`)에 프로젝트를 위치시키는 것이 가장 안전하고 표준적인 방법입니다.

---

#### **참고: 새 일반 사용자 추가 방법 (Ubuntu/Debian 기준)**
만약 `root` 계정만 있다면, 아래 명령어로 새 사용자를 만들고 권한을 부여한 뒤 전환하여 진행하세요.

1.  **새 사용자 생성 (`<username>`을 원하는 이름으로 변경)**
    ```bash
    adduser <username>
    ```

2.  **sudo 권한 부여 (관리자 명령어 실행을 위함)**
    ```bash
    usermod -aG sudo <username>
    ```

3.  **새 사용자로 전환**
    ```bash
    su - <username>
    ```
이제 프롬프트가 바뀌며, 이 사용자의 홈 디렉터리에서 다음 단계를 진행할 수 있습니다.

---

### 1단계: 서버에 기본 도구 설치 (Git, Python)

서버에 Git, Python3, pip, venv가 이미 설치되어 있는지 확인하고, 설치되어 있지 않다면 설치합니다. 아래 스크립트를 복사하여 터미널에 붙여넣고 실행하세요.

```bash
# 시스템 패키지 목록 업데이트
sudo apt-get update

# 필수 패키지 설치 (Git, Python3, pip, venv)
# apt는 이미 최신 버전이 설치된 경우 자동으로 건너뜁니다.
echo "필수 시스템 패키지(git, python3, python3-pip, python3-venv)를 설치/업데이트합니다."
sudo apt-get install -y git python3 python3-pip python3-venv

# 버전 확인
echo "--- 설치된 버전 ---"
git --version
python3 --version
pip3 --version
echo "--------------------"

```
*(위 스크립트는 Ubuntu/Debian 기반 시스템용입니다.)*

---

### 2단계: GitHub에서 프로젝트 클론 (Clone)

프로젝트를 복제합니다. (`--recurse-submodules` 옵션 필수)

1.  **프로젝트 클론:** `git clone --recurse-submodules https://github.com/manin21st/trade_stock.git`
2.  **폴더로 이동:** `cd trade_stock`

---

### 3단계: 파이썬 가상 환경 설정 및 라이브러리 설치

프로젝트별로 독립된 파이썬 환경을 사용하여 시스템과의 충돌을 방지합니다.

1.  **가상 환경 생성:**
    ```bash
    python3 -m venv venv
    ```
    *(프로젝트 루트 디렉토리(`trade_stock`)에 `venv`라는 폴더가 생성됩니다.)*

2.  **가상 환경 활성화:**
    ```bash
    source venv/bin/activate
    ```
    *(터미널 프롬프트 앞에 `(venv)`가 표시됩니다. **이후 모든 명령어는 이 활성화된 환경에서 실행해야 합니다.**)*
    
    ***참고:** 서버에 다시 접속하거나 새 터미널을 열면, `cd ~/trade_stock` 후 `source venv/bin/activate`를 다시 실행하여 가상 환경을 활성화해야 합니다.*

3.  **pip 업그레이드 및 라이브러리 설치:**
    ```bash
    pip install --upgrade pip
    pip install pandas
    pip install -r open-trading-api/requirements.txt
    ```
    *(이제 `pip3` 대신 `pip`를 사용해도 가상 환경에 설치됩니다.)*

---

### 4단계: 설정 파일(`kis_devlp.yaml`) 생성

리눅스 홈 디렉터리 아래에 설정 파일을 생성합니다.

1.  **디렉터리 생성:** `mkdir -p ~/KIS/config`
2.  **설정 파일 생성 및 편집:** `nano ~/KIS/config/kis_devlp.yaml`
    (로컬 PC의 파일 내용을 복사하여 붙여넣고 저장)

---

### 5단계: 자동매매 엔진 실행

**가상 환경이 활성화된 상태(`(venv)` 표시 확인)에서** 아래 명령어를 실행합니다.

1.  **실행:** `nohup python3 main_cmd.py &`
2.  **로그 확인:** `tail -f nohup.out` 또는 `tail -f main_cmd.log`
3.  **종료:** `ps -ef | grep main_cmd.py`로 PID를 찾은 후 `kill <PID>`

---

### 6단계: 향후 업데이트 동기화

GitHub에 반영된 최신 코드를 서버에 적용(동기화)합니다.

```bash
git pull && git submodule update --init --recursive
```